<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>r_notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="310_R_notes_files/libs/clipboard/clipboard.min.js"></script>
<script src="310_R_notes_files/libs/quarto-html/quarto.js"></script>
<script src="310_R_notes_files/libs/quarto-html/popper.min.js"></script>
<script src="310_R_notes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="310_R_notes_files/libs/quarto-html/anchor.min.js"></script>
<link href="310_R_notes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="310_R_notes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="310_R_notes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="310_R_notes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="310_R_notes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<pre><code>PURPOSE:  Collect all notes, links, references for R to here.
NO installation (R, Rstudio, etc) in this file</code></pre>
<!--
KEEP as .qmd file
-->
<section id="todo" class="level2">
<h2 class="anchored" data-anchor-id="todo">TODO</h2>
<p>explain process: capture unevaluated code; manipulate it; later evaluate</p>
<ul>
<li>defuse, substitution, quasiquotation,</li>
<li>injection (into unevaluated expression)</li>
<li>defuse &amp; inject are opposites</li>
<li>embrase {{}}, tells function must first evalute the unevaluated content inside {{}}</li>
<li>one idea is to carry unevaluated code and envir to another function; for either maniputlation or evalution.</li>
</ul>
</section>
<section id="compare" class="level2">
<h2 class="anchored" data-anchor-id="compare">Compare</h2>
<div class="cell">
<pre><code>[1] 3 3 3
[1] 3 3 3
[1] 9</code></pre>
</div>
<p><strong>AST</strong> Diagram expression into various parts (calls, symbols, constants?) Metacode refers to manipulation of this tree. NSE refers to tinker with how fct evaluates arguments.</p>
<p><strong>attach</strong> - add df/list/datafile/env to <em>search list</em>, at a <code>pos</code> and <code>name</code> - for database, can access column names, unquoted. - detach(mtcars) to remove from search list - compare to <code>with</code> - https://stat.ethz.ch/R-manual/R-devel/library/base/html/attach.html</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">".GlobalEnv"</span>        <span class="st">"package:rlang"</span>     <span class="st">"package:stats"</span>    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">"package:graphics"</span>  <span class="st">"package:grDevices"</span> <span class="st">"package:utils"</span>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">"package:datasets"</span>  <span class="st">"package:methods"</span>   <span class="st">"Autoloads"</span>        </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">"package:base"</span>     </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars, <span class="at">n=</span><span class="dv">3</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>               mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>Mazda RX4     <span class="fl">21.0</span>   <span class="dv">6</span>  <span class="dv">160</span> <span class="dv">110</span> <span class="fl">3.90</span> <span class="fl">2.620</span> <span class="fl">16.46</span>  <span class="dv">0</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>Mazda RX4 Wag <span class="fl">21.0</span>   <span class="dv">6</span>  <span class="dv">160</span> <span class="dv">110</span> <span class="fl">3.90</span> <span class="fl">2.875</span> <span class="fl">17.02</span>  <span class="dv">0</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>Datsun <span class="dv">710</span>    <span class="fl">22.8</span>   <span class="dv">4</span>  <span class="dv">108</span>  <span class="dv">93</span> <span class="fl">3.85</span> <span class="fl">2.320</span> <span class="fl">18.61</span>  <span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">1</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(hp,    <span class="co"># object 'hp' not found ,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">print</span>(<span class="st">" There is no hp in environent </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">" There is no hp in environent </span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># add to search list</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mtcars)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">".GlobalEnv"</span>        <span class="st">"mtcars"</span>            <span class="st">"package:rlang"</span>    </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">"package:stats"</span>     <span class="st">"package:graphics"</span>  <span class="st">"package:grDevices"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">"package:utils"</span>     <span class="st">"package:datasets"</span>  <span class="st">"package:methods"</span>  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">"Autoloads"</span>         <span class="st">"package:base"</span>     </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>hp  <span class="co"># now no error</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">110</span> <span class="dv">110</span>  <span class="dv">93</span> <span class="dv">110</span> <span class="dv">175</span> <span class="dv">105</span> <span class="dv">245</span>  <span class="dv">62</span>  <span class="dv">95</span> <span class="dv">123</span> <span class="dv">123</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">205</span> <span class="dv">215</span> <span class="dv">230</span>  <span class="dv">66</span>  <span class="dv">52</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">20</span>]  <span class="dv">65</span>  <span class="dv">97</span> <span class="dv">150</span> <span class="dv">150</span> <span class="dv">245</span> <span class="dv">175</span>  <span class="dv">66</span>  <span class="dv">91</span> <span class="dv">113</span> <span class="dv">264</span> <span class="dv">175</span> <span class="dv">335</span> <span class="dv">109</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># remove from search list</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(mtcars)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># remove package </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">".GlobalEnv"</span>        <span class="st">"package:rlang"</span>     <span class="st">"package:stats"</span>    </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">"package:graphics"</span>  <span class="st">"package:grDevices"</span> <span class="st">"package:utils"</span>    </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">"package:datasets"</span>  <span class="st">"package:methods"</span>   <span class="st">"Autoloads"</span>        </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">"package:base"</span>     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>bindings:</strong> - link between name (symbol) and an object - EX: <code>f</code> as a symbol and <code>function definition</code> (function(x) {…}) - https://r-pkgs.org/dependencies-mindset-background.html#sec-dependencies-search</p>
<p><strong>bquote</strong> SEE String Interpolation <strong>Call</strong> A call is an unevaluated function, together with arguments that are (Rmk: .Call() is unrelated, calls C function)</p>
<p><strong>create a call</strong> - See: R-lang 6.5, call, sys.call vs match.call</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>f  <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">^</span><span class="dv">2</span>}</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cl  <span class="ot">&lt;-</span> <span class="fu">call</span>(<span class="st">"f"</span>, <span class="dv">3</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display f as unevaluated f(3)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>cl</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  Test for call.</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.call</span>(f)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.call</span>(<span class="st">"f"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.call</span>(cl)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  To evaluate a call.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">eval</span>(cl)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">9</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">call</span>(<span class="st">"f"</span>, <span class="dv">2</span><span class="sc">+</span><span class="dv">3</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">5</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># call("f", sin(x))</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">call</span>(<span class="st">"f"</span>, <span class="fu">sin</span>(x <span class="ot">&lt;-</span> pi<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># call("f", sin (x + y))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like symbol, expression, call is typeof ‘language’.</p>
<pre><code>three kinds of language objects that are available for modification, calls,
expressions, and functions
r-lang 6.1</code></pre>
<p>is.call() is T only for calls. See: “in try… 4010_match_call_examples.Rmd” ***</p>
<p><strong>Calling environment of a function</strong> To run, a function must be called. Calling environment refers to environment of the calling function. Also called parent environment. Not to be confused with a function environment. See example ?? The <code>calling function</code> is function actually making the call. f = function()g() # f is calling function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x is evaluated in calling env (globalenv()) here), but value of x,y is not changed in that environment</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span>pi<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sin</span>(<span class="at">x =</span> y <span class="sc">+</span> .<span class="dv">001</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9999995</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.570796</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.570796</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Currying</strong> Takes a function, partially evaluates, and returns as new function. Example: f(x,y,z) evaluated at z=a, returns g(x,y) = f(x,y,a)</p>
<p><strong>context</strong> internal, stack of C structs, track execution (see R Internals 1.4) Allows flow control | error reporting (traceback) | sys.* to work. (except sys.status)</p>
<p>Closures create context. internals do not. primitives only in special situations. (sys.frame, sys.call count closures from either end of context stack) TODO - do not understand.</p>
<p>Contexts are Not counted, not reported, not on stack, and coder has no access to these functions. REF: R Internals 1.4</p>
<p><strong>byte code</strong> “Readable” concise instructions; not machine code; no user access; use JIT compiler or interpeter</p>
<p><strong>Deparse</strong> See <strong>parse</strong>.</p>
<p><strong>defuse</strong> Synonym for capture unevaluated code, stop immediate evaluation,</p>
<p><strong>eval()</strong> Note: rlang::expr(x) quotes (or converts ) arg to expression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span> ( </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(x)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">expr</span>(x))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">expr</span>(x <span class="sc">+</span> y))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">expr</span>(x <span class="sc">+</span> y), <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y=</span><span class="dv">20</span>))    <span class="co"># </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">expr</span>(x <span class="sc">+</span> y), rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y=</span><span class="dv">20</span>))  <span class="co"># new envir</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># eval does not quote 1st argument</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">print</span>(x<span class="sc">+</span><span class="dv">1</span>), rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">x=</span><span class="dv">2000</span>))  <span class="co"># 3, not 2001</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">expr</span>(<span class="fu">print</span>(x <span class="sc">+</span> <span class="dv">1</span>)), <span class="fu">list</span>(<span class="at">x=</span><span class="dv">1000</span>))  <span class="co"># 3</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">print</span>(x<span class="sc">+</span><span class="dv">1</span>)) <span class="co">#3</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1001</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(rlang<span class="sc">::</span><span class="fu">expr</span>(x)) <span class="co">#T</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Evaluation or execution environment</strong> In R, a function runs in an environment specific to that function. Also referred to as frame or context. This frame holds evaluation environment. The frame ends when the function completes.</p>
<p><strong>Evaluation</strong> parser, evaluator SEE R-lang definitions 2.1.3</p>
<pre><code>When a user types a command at the prompt (or when an expression is read from a
file) the first thing that happens to it is that the command is transformed by
the parser into an internal representation. The evaluator executes parsed R
expressions and returns the value of the expression. All expressions have a
value. This is the core of the language. </code></pre>
<p>https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Evaluation-of-expressions</p>
<p><strong>Expression</strong></p>
<p><a href="https://cran.r-project.org/doc/manuals/R-lang.html#Evaluation">R language definition</a> From r-lang 2.1.4</p>
<div class="line-block">&nbsp;&nbsp;&nbsp;In R one can have objects of type “expression”. An expression contains one or<br>
&nbsp;&nbsp;&nbsp;more statements. A statement is a syntactically correct collection of tokens.<br>
&nbsp;&nbsp;&nbsp;Expression objects are special language objects which contain **parsed but<br>
&nbsp;&nbsp;&nbsp;unevaluated R statements.** The main difference is that an expression object can<br>
&nbsp;&nbsp;&nbsp;contain several such expressions. Another more subtle difference is that<br>
&nbsp;&nbsp;&nbsp;objects of type “expression” are only evaluated when explicitly passed to eval,<br>
&nbsp;&nbsp;&nbsp;whereas other language objects may get evaluated in some unexpected cases.</div>
<p>(emphasis added)</p>
<p>Interactively, a single, valid R statement that returns an value is called an expression.</p>
<p>An expression also a formal language construction with list structure. The function expression() takes an R object and returns expression. Note: a <code>statement</code> is code that may do things (side effects) but does not return anything. Hadley defines expression as an “object that stores quoted code without evaluating it.” (tidyr cheat sheet) SEE evaluation.</p>
<p>from <strong>Mailund</strong> (metaprogramming, Chapter 3) “Every statement you have in your programs is also an expression that evaluates to some value (which, of course, might be NULL). This includes control structures and function bodies. You can consider everything an expression; it’s just that some expressions involve evaluating several contained expressions for their side effects before returning the result of the last expression they evaluate. From a metaprogramming perspective, though, you are most interested in expressions you can get <strong>your hands on and examine, modify, or evaluate within a program.</strong>” Examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># expression examples:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(<span class="fu">quote</span>(x)) <span class="co">#T</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(<span class="fu">quote</span>(<span class="dv">1</span>)) <span class="co">#T</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(<span class="fu">quote</span>(x <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> y))   <span class="co">#T</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(<span class="fu">quote</span>(<span class="cf">if</span> (x  <span class="sc">&gt;</span> z) <span class="fu">print</span>(<span class="st">"yes"</span>)))   <span class="co">#T</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># body of function</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">is_expression</span>(<span class="fu">body</span>(<span class="at">f =</span> <span class="cf">function</span>() x<span class="sc">^</span>y))   <span class="co"># T</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># manipulate expression:</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span> <span class="fu">quote</span>(x <span class="sc">+</span> y <span class="sc">+</span> z)  <span class="co"># x + y + z</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(e)   <span class="co"># 3</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>e[[<span class="dv">3</span>]]  <span class="ot">&lt;-</span> <span class="fu">quote</span>(z <span class="sc">+</span> <span class="dv">3</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>e <span class="co"># x + y + (z + 3)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y <span class="sc">+</span> (z <span class="sc">+</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Expression v Language</strong> R expressions based on list and can be broken down further. Often these are language pieces. Lanugage use pairlists.</p>
<p><strong>First Class</strong> - A function can also be used as an argument to another function. Example: lapply(list(), mean)</p>
<p><strong>Frame vs Environment</strong> Frame refers to the calling stack of functions. Environment, in R, is property of function, where it looks to find non-local variables.</p>
<p><strong>Function</strong> - formals(f) returns formal arguments of function, with default values, but NO evaluation, NO look in environment. formals are actually pairlist. Can obtain/modify this pairlist. Formal arguments become promises in the evaluation environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x,<span class="at">y =</span> <span class="dv">1</span>, <span class="at">z =</span> w <span class="sc">+</span> <span class="cf">function</span>() <span class="fu">print</span>(<span class="st">"hi"</span>))  x <span class="sc">+</span> y <span class="sc">+</span> z</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>x</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>y</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>z</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>w <span class="sc">+</span> <span class="cf">function</span>() <span class="fu">print</span>(<span class="st">"hi"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f) <span class="sc">|&gt;</span> <span class="fu">class</span>()   <span class="co"># pairlist</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"pairlist"</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># can obtain, modify formals</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)[[<span class="dv">2</span>]]</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)[[<span class="dv">2</span>]]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">quote</span>(a) </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>f    <span class="co"># changed</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x, <span class="at">y =</span> a, <span class="at">z =</span> w <span class="sc">+</span> <span class="cf">function</span>() <span class="fu">print</span>(<span class="st">"hi"</span>)) </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y <span class="sc">+</span> z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>body(f) returns an expression, the R code to run, unevaluated, no substitution</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(f)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y <span class="sc">+</span> z</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(f) <span class="sc">|&gt;</span> <span class="fu">class</span>()  <span class="co"># call</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"call"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(f) <span class="sc">|&gt;</span> rlang<span class="sc">::</span><span class="fu">is_expression</span>()   <span class="co"># T</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>environment(f)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(f)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>environment<span class="sc">:</span> R_GlobalEnv<span class="sc">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># attributes of function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Obtain attributes, even names and defualt values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(<span class="fu">formals</span>(f))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>names</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"x"</span> <span class="st">"y"</span> <span class="st">"z"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">formals</span>(f))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"x"</span> <span class="st">"y"</span> <span class="st">"z"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)[[<span class="st">"y"</span>]]   <span class="co"># a</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>code environment(f) finds values of non-formal (non-local) variables where the function was created.</p>
<p><strong>Higher Order Function</strong> Function that takes another function as an argument and …</p>
<p><strong>inject</strong> insert expression into AST?</p>
<p><strong>immutable</strong></p>
<p><strong>Interactive vs.&nbsp;Non-Interactive</strong> R, or S, originally designed to be interactive, ie command and response at console. .R, .Rmd, Rscript, R CMD BATCH (TODO: some error conditions do not work in BATCH ??)</p>
<p><strong>Lambda Calculus</strong> Instead of naming function (f(x,y) = x^2 + y^2) create abstraction. (x,y) –&gt; x^2 + y^2. Or instead of g(x) = x + 2; write lambdax.x+2. Easy to chain</p>
<p><strong>Lexical Scope</strong> How R function finds <em>unbound</em> variables: in environment where function was created. <strong>Dynamic Scope</strong> Method to find variables in Call Stack at runtime. R uses Lexical Scope, however the R Language allows coder to select environment to evaluate variables. (REF: June Choe Slack/Nov 3 2021)</p>
<p>Scheme added (?) Portion of code in which binding applies to a variable??</p>
<p>In R, an “evaluator” find any “unbound symbols” (in an expression) by using variable bindings in effect when created.</p>
<p><strong>local</strong></p>
<p>local leaves nothing inenviron after running; easy to use; (TODO) study internals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) x <span class="sc">+</span> y</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">call</span>(<span class="st">"f"</span>, <span class="fu">list</span>(a,b))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="fu">list</span>(<span class="dv">10</span>, <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>match</strong> - match.arg - match.call - match.fun</p>
<p><strong>namespace:</strong> REF: https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Namespaces Namespaces are <em>environments</em> associated with packages ( + base pkg, special) A package pkg defines two environments namespace:pkg and package:pkg: it is package:pkg that can be attached and form part of the search path.</p>
<ul>
<li>Tieryn(2003) http://homepage.divms.uiowa.edu/~luke/R/namespaces/morenames.pdf</li>
</ul>
<p>examples: SEE 9009_</p>
<p>Treat code as data: ability to manipulate code before evaluated. <strong>NSE, Non-Standard Evaluation</strong> - https://edwinth.github.io/blog/nse/ - https://thomasadventure.blog/posts/understanding-nse-part1/ $ (uses NSE), [[ (does not)</p>
<p><strong>Standard evaluation</strong> In se expressions are evaluated immediately, ie the code and all variables are found the value is inserted. (SEE Brodie, rev() example)</p>
<p><strong>operator</strong> (non-R) An operate takes a function f and returns new function g. Example: <span class="math inline">\(f'(x) = g(x)\)</span></p>
<p><strong>package:</strong></p>
<p><strong>Pairlist</strong></p>
<p><strong>Parent Frame of function</strong> If function g() is called inside body of function f, the g has the parent frame (aka calling environment) that is execution environment of f.&nbsp;DRAW Diagram</p>
<p><strong>Parse</strong> (TODO) Parse returns expression or creates ast structure? Convert a string (character vector, such as “x+y”) into an R Expression (ie code), which is NOT a string. Motivation is to setup R object for manipulation <em>before</em> evaluation. Parse(*.R) removes comments. Note: after parsing, the result is NOT character(1), a string.</p>
<p><em>parse_expr()</em> returns string, given an expression (tip: should not do this often) Hadley 18.4</p>
<p><strong>Deparse</strong> converts an R Expression to a string (character vector) .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="st">"a + b"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="at">text=</span>x)   <span class="co"># expression(a+b)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expression</span>(a <span class="sc">+</span> b)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># but, does not evaluate, b/c it quotes immediately</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="fu">parse</span>(<span class="at">text=</span>x))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>█─parse </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>└─text <span class="ot">=</span> x </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="fu">parse</span>(<span class="at">text=</span><span class="sc">!!</span>x))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>█─parse </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>└─text <span class="ot">=</span> <span class="st">"a + b"</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>?ast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Parse &amp; Deparse are NOT? opposites. See Murdoch</p>
<p>(latex) parse: string ==<code>&gt;</code> R expression (error if invalid) deparse: R expression ==<code>&gt;</code> string (actually: structure(expression(), scrfile)</p>
<p><strong>promise</strong> Hadley: 18.4 captures expression and environment</p>
<p><strong>options</strong> Temporary vs global vs local. Read R manual.(TODO)</p>
<ul>
<li><p><code>if</code>, <code>+</code>, sin, sqrt</p></li>
<li><p>C functions</p></li>
<li><p>SEE ADV-R Chapter 6, code: 059 (myoldcode)</p></li>
<li><p>SEE https://nsaunders.wordpress.com/2018/06/22/idle-thoughts-lead-to-r-internals-how-to-count-function-arguments/</p></li>
<li><p>SEE R Internals/Ch 2</p></li>
<li><p>Do not understand at deeper level</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span><span class="al">TODO</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   R complains about putting function in data.frame</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">### check several functions</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>y  <span class="ot">&lt;-</span> <span class="fu">list</span>(sin, <span class="st">"sin"</span>, c, <span class="cf">switch</span>, typeof, sqrt, <span class="st">`</span><span class="at">if</span><span class="st">`</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(sin)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="st">"sin"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(c)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(sqrt)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="st">`</span><span class="at">if</span><span class="st">`</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">deparse</span>(y)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> add class()</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">object =</span> y,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">typeof =</span> <span class="fu">sapply</span>(y, typeof),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">is.primitive =</span> <span class="fu">sapply</span>(y, is.primitive),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">is.function =</span> <span class="fu">sapply</span>(y, is.function))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>R</strong> R has two parents: S, based on C, Fortran for statistics. R also has functional component, based on Scheme.</p>
<p>It is possible to abuse R, using it more like S code. (?)</p>
<p><strong>Reification</strong> Abstract idea to treat all code as “data”, including functions, structures, etc. This means all such objects can be modified by code. C has. (TODO)</p>
<p><strong>Referencial Transparency</strong></p>
<p>A function f is IF replacing x (an expression) with its value returns same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x) x</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">f</span>(x), <span class="fu">f</span>(<span class="dv">6</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, not all R functions have this property.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="dv">6</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">quote</span>(x), <span class="fu">quote</span>(<span class="dv">6</span>))               <span class="do">##  F</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>quote</strong> (Scheme) does not look for bindings</p>
<p><strong>quosure</strong></p>
<p>expression is evaluated in given env</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluates to 2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">new_quosure</span>(<span class="fu">expr</span>(a <span class="sc">+</span> <span class="dv">1</span>), <span class="fu">env</span>(<span class="at">a =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="fu">eval_tidy</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 11</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">new_quosure</span>(<span class="fu">expr</span>(a <span class="sc">+</span> <span class="dv">1</span>), <span class="fu">env</span>(<span class="at">a =</span> <span class="dv">10</span>)) <span class="sc">|&gt;</span> <span class="fu">eval_tidy</span>()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, teal:: qenv stores resulting env, after evala</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(teal.code)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">'teal.code'</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>The following object is masked from <span class="st">'package:rlang'</span><span class="sc">:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    get_env</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>teal.code<span class="sc">::</span><span class="fu">qenv</span>() <span class="sc">|&gt;</span> <span class="fu">within</span>({a <span class="ot">&lt;-</span> <span class="dv">1</span>; b <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="dv">2</span>}) <span class="sc">|&gt;</span> <span class="fu">get_env</span>() <span class="sc">|&gt;</span> <span class="fu">as.list</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>a</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>b</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#$a [1] 1</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#$b [1] 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please see <strong>quo</strong> as a tool for evaluation to better control <strong>evaluation environment</strong> whereas qenv more as a tool for reproducibility that <strong>captures the outcome of evaluation</strong>. One is “before” and the other one is “after”.</p>
<p>REF: Advanced-R ~ 6.5 Data structure with expression + environment. WHY? With dot (…) often pass several of these rlang::eval_tidy() # takes 1 arg (simpler) but base:eval(, ) # requires 2 args <strong>Referencial Semantics</strong> Changes to values are done in memory. There is no copy. (Example: why important. Also other properties of functions, inverse, etc) R passes by value. (So argument is evaluated before the call?)</p>
<p><strong>Search List</strong> Heirarchy of packages: First is globalenv, followed by packages in reverse order. Loading a package not necessary attach. library() will load and attach.</p>
<p><strong>side effect</strong> A function may access global and formal variables read-only. Only local variables may be modified. - a popup? console output? no changes to files, no graphs</p>
<p><strong>srcref</strong> Is an attribute of all functions. The body() contains code only. The srcref contains original code, plus comments and formatting.</p>
<p><strong>Substitution</strong> When used in function with formal variable, substitute stops evaluation, captures the user’s code and returns a call (ie unevaluated ) Substitution is NOT eval.</p>
<p>In globalenv, substitute returns symbol or call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(x)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symbol</span>(<span class="fu">substitute</span>(x)) <span class="co">#T</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(x<span class="sc">+</span>y)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symbol</span>(<span class="fu">substitute</span>(x<span class="sc">+</span>y)) <span class="co">#F</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">is.call</span>(<span class="fu">substitute</span>(x<span class="sc">+</span>y))   <span class="co">#T</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But in a function, <code>substitute</code> captures unevaluated expression; use <code>deparse</code> for string representation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">substitute</span>(x)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x<span class="sc">+</span> y<span class="sc">+</span>z)   <span class="co"># x + y + z</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> y <span class="sc">+</span> z</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">deparse</span>(<span class="fu">substitute</span>(x))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(x <span class="sc">+</span> y <span class="sc">+</span> z)   <span class="co"># "x+y+z"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"x + y + z"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="line-block">&nbsp;&nbsp;substitute returns the parse tree for the (unevaluated) expression expr, substituting any variables bound in env.</div>
<p><strong>syntax</strong> How code looks, is { in right place, a grammar.</p>
<p><strong>Syntax Sugar</strong> Syntax to make easier for human to express or write code efficiently.</p>
<p><strong>semantics</strong> What does the code DO?</p>
<p><strong>String</strong> String (“5+5”) is NOT call. No such thing as evaluating a string. See 0210_ You can PARSE a string and then manipulate it. Simpler to eval a quote(5+5) to return the sum.</p>
<p><strong>String Interpolation</strong></p>
<p>Method to substitute the value of expr into a string. Can think of it as <code>template</code> with holes. SEE: https://www.r-bloggers.com/2018/03/math-notation-for-r-plot-titles-expression-and-bquote/</p>
<p>bquote examples SEE 410</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">5</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bquote</span>(x <span class="sc">==</span> .(x))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>x <span class="sc">==</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="symbol" class="level3">
<h3 class="anchored" data-anchor-id="symbol">Symbol</h3>
<p><a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Symbol-lookup">3.1.2 Symbol lookup</a> | In this small example y is a symbol and its value is 4. A symbol is an R object too,</p>
<p>Q: This is true, mathematically: a<em>(b+c) = a</em>b + a*c.&nbsp;In practice, I get to choose to evaluate (insert values) with the LHS or the RHS, expecting the exact same result had I done the other. Relationship to Symbol in Metaprogramming?</p>
<p><strong>symbol</strong> - human readale, points to area in memory, immutable, not a string, not a value, not set of instructions. In LISP (and R?) you EVALUATE symbols to get a value.</p>
<p>stored in a lookup table? Two symbols can be compared, if equal then same memory. (is symbol evulated ??) SEE: https://stackoverflow.com/questions/8846628/what-exactly-is-a-symbol-in-lisp-scheme</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symbol</span>(y)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is.name</span>(y)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">is.object</span>(y)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># but</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">as.symbol</span>(y)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symbol</span>(y)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">4</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See <strong>R Lang Ref: 2.1.3.1</strong> Symbol (aka name), usually name of R object. Use `as.name() to coerce to symbol or quote() or atoms of parse()</p>
<pre><code>In order to manipulate symbols we need a new element in our language: the
ability to quote a data object. Suppose we want to construct the list (a
b). We can’t accomplish this with (list a b), because this expression
constructs a list of the values of a and b rather than the symbols
themselves. This issue is well known in the context of natural languages,
where words and sentences may be regarded either as semantic entities or as
character strings (syntactic entities). The common practice in natural
languages is to use quotation marks to indicate that a word or a sentence
is to be treated literally as a string of characters. For instance, the
first letter of “John” is clearly “J.” If we tell somebody “say your name
aloud,” we expect to hear that person’s name. However, if we tell somebody
“say ‘your name’ aloud,” we expect to hear the words “your name.” Note that
we are forced to nest quotation marks to describe what somebody else might
say. We can follow this same practice to identify lists and symbols that
are to be treated as data objects rather than as expressions to be
evaluated. However, our format for quoting differs from that of natural
languages in that we place a quotation mark (traditionally, the single
quote symbol ’) only at the beginning of the object to be quoted. We can
get away with this in Scheme syntax because we rely on blanks and
parentheses to delimit objects. Thus, the meaning of the single quote
character is to quote the next object. Now we can distinguish between
symbols and their values:
</code></pre>
<p>https://stackoverflow.com/questions/8846628/what-exactly-is-a-symbol-in-lisp-scheme ## Tidy Evaluation - pronouns, to distinguish between objects in environment ls() .env<span class="math inline">\(cyl and
  not associated with the df and data columns in df .data\)</span>cyl (df)</p>
<p><strong>Variable</strong> Three kinds:<br>
* formals,x: f = function(x= … )&nbsp; formalArgs() * local,a: f = function() {a =10}<br>
* free, unbound, global, z: f = function() (print(z))</p>
</section>
<section id="within" class="level3">
<h3 class="anchored" data-anchor-id="within">within()</h3>
<p>Given an environ, evaluate expresson (also useful with datasets)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="dv">100</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>b<span class="ot">=</span><span class="dv">200</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">with</span>(<span class="fu">globalenv</span>(), <span class="at">expr =</span> {z<span class="ot">=</span> a<span class="sc">+</span>b} )</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>z</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">300</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">with</span>(mtcars, <span class="at">expr =</span> {z <span class="ot">=</span> <span class="fu">log</span>(hp)})  <span class="co"># column only</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">within</span>(mtcars, <span class="at">expr =</span> {z<span class="ot">=</span><span class="fu">log</span>(hp)})  <span class="co"># entire dataset</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb        z</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>Mazda RX4         <span class="fl">21.0</span>   <span class="dv">6</span>  <span class="dv">160</span> <span class="dv">110</span> <span class="fl">3.90</span> <span class="fl">2.620</span> <span class="fl">16.46</span>  <span class="dv">0</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">4</span> <span class="fl">4.700480</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>Mazda RX4 Wag     <span class="fl">21.0</span>   <span class="dv">6</span>  <span class="dv">160</span> <span class="dv">110</span> <span class="fl">3.90</span> <span class="fl">2.875</span> <span class="fl">17.02</span>  <span class="dv">0</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">4</span> <span class="fl">4.700480</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>Datsun <span class="dv">710</span>        <span class="fl">22.8</span>   <span class="dv">4</span>  <span class="dv">108</span>  <span class="dv">93</span> <span class="fl">3.85</span> <span class="fl">2.320</span> <span class="fl">18.61</span>  <span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">4</span>    <span class="dv">1</span> <span class="fl">4.532599</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>Hornet <span class="dv">4</span> Drive    <span class="fl">21.4</span>   <span class="dv">6</span>  <span class="dv">258</span> <span class="dv">110</span> <span class="fl">3.08</span> <span class="fl">3.215</span> <span class="fl">19.44</span>  <span class="dv">1</span>  <span class="dv">0</span>    <span class="dv">3</span>    <span class="dv">1</span> <span class="fl">4.700480</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>Hornet Sportabout <span class="fl">18.7</span>   <span class="dv">8</span>  <span class="dv">360</span> <span class="dv">175</span> <span class="fl">3.15</span> <span class="fl">3.440</span> <span class="fl">17.02</span>  <span class="dv">0</span>  <span class="dv">0</span>    <span class="dv">3</span>    <span class="dv">2</span> <span class="fl">5.164786</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>Valiant           <span class="fl">18.1</span>   <span class="dv">6</span>  <span class="dv">225</span> <span class="dv">105</span> <span class="fl">2.76</span> <span class="fl">3.460</span> <span class="fl">20.22</span>  <span class="dv">1</span>  <span class="dv">0</span>    <span class="dv">3</span>    <span class="dv">1</span> <span class="fl">4.653960</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><strong>function</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>f  <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x=</span><span class="cn">NULL</span>) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(f)      <span class="do">## pairlist</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>x</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(f)         <span class="do">## language, $\code{call}$</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(f)  <span class="do">## environment</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>environment<span class="sc">:</span> R_GlobalEnv<span class="sc">&gt;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(f)         <span class="do">## closure</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (<span class="at">x =</span> <span class="cn">NULL</span>) </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## returns expression</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="at">text=</span> <span class="st">'2^2'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expression</span>(<span class="dv">2</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="at">text=</span> <span class="st">'2*a'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">expression</span>(<span class="dv">2</span> <span class="sc">*</span> a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>call</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>f  <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x=</span><span class="cn">NULL</span>) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cl</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>cl  <span class="ot">&lt;-</span> <span class="fu">call</span>(<span class="st">"f"</span>, <span class="fu">list</span>(<span class="at">x=</span><span class="dv">2</span>))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">is.function</span>(cl)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is.call</span>(cl)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Args must be evaluated, even if f is unevaluted </span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    x  <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">call</span>(<span class="st">"f"</span>, <span class="fu">list</span>(x))</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="fu">list</span>(<span class="dv">2</span>))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#call("f", list(x=a))   # throws error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>res  <span class="ot">&lt;-</span> <span class="fu">substitute</span>(x<span class="sc">+</span>a) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>x <span class="sc">+</span> a</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.call</span>(res)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>:::</p>
</section>
</section>
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   Explain how Base R finds column name</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">'dplyr'</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>The following objects are masked from <span class="st">'package:stats'</span><span class="sc">:</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    filter, lag</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>The following objects are masked from <span class="st">'package:base'</span><span class="sc">:</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    intersect, setdiff, setequal, union</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>col <span class="ot">=</span> <span class="st">"hair_color"</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(starwars[, <span class="fu">eval</span>(col) ]) )</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(starwars[, col ]) )</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">{{&lt; include _meta_questions.qmd &gt;}}</h2>
<section id="k-nearest-neighbors-k-is-given" class="level4">
<h4 class="anchored" data-anchor-id="k-nearest-neighbors-k-is-given">K-nearest neighbors, K is given</h4>
<p><span class="math inline">\(\forall x \in X\)</span> , which could be any dimension , is already assigned to a region. For a new point, examine its K nearest neighbors who decide by majority vote which region <span class="math inline">\(x\)</span> belongs to. SEE: wine example SEE: Gaglow book.</p>
</section>
<section id="bias-var-tradeoff." class="level4">
<h4 class="anchored" data-anchor-id="bias-var-tradeoff.">Bias-Var Tradeoff.</h4>
<p>With non-zero <code>noise</code>, of variance <span class="math inline">\(\sigma^{2}\)</span> the best approximate to <span class="math inline">\(f(x)\)</span> will always have non-zero error: Isn’t there a relation betwee E, VAR? like x and p ?</p>
<p><span class="math display">\[
Error = E(f_hat) + Var(f_hat) + \sigma^{2}
\]</span></p>
<p>SEE Berkeley Crash Course; Matloff</p>
</section>
<section id="why-rlang-to-june" class="level3">
<h3 class="anchored" data-anchor-id="why-rlang-to-june">2023-05-16, Why Rlang? to june</h3>
<p>I’m in rlang book club, not up-to-date, and debating WHY? work through rlang:: I think more logical to approach rlang as follows:</p>
<p>(1)learn <em>some</em> lisp (scheme), then (2) learn base R (as language, to manipulate), and only (3) then work through rlang:: <em>code</em> as an EXAMPLE of magic one can do with lanuage.</p>
<p>If you have time and willing, feel free to answer to the entire group, if you wish. Or, you are too busy, don’t worry about reply. I think others have similar questions.</p>
<p>Here are few points that might clarify where I am:</p>
<ul>
<li>R about 4 years, including tidyverse</li>
<li>struggle with rlang:: not because ideas are especially difficult but becuase I find package to be verbose, with imprecise definitions and built upon a structure of many other packages. And I do not have all the ideas nailed down.</li>
<li>the ideas, once I draw picture or think a bit, seem very logical, useful and <em>cool</em> (or do I fool myself?)</li>
<li>So not why focus on ideas first (ie scheme or equivlent), then see how R implements, and then build something new.</li>
<li>Me: minimal C; minimal Lisp.</li>
<li>But baffled why so much time being spent on <em>.data[[]]</em>, pronouns, new notation. What is wrong with just bquote? And if bquote doesn’t cut it in certain instances show why <em>.data[[]]</em> code improves upon bquote.</li>
<li>I’ve also tried to write a glossary + code examples for each metaprogramming idea in base R (but only got more confused)</li>
</ul>
</section>
</section>
<section id="sectionr" class="level2">
<h2 class="anchored" data-anchor-id="sectionr">section{R}</h2>
<section id="r-defintions-terse-examples" class="level3">
<h3 class="anchored" data-anchor-id="r-defintions-terse-examples">R, DEFINTIONS, TERSE EXAMPLES</h3>
<pre><code>        See ~/code/try_things_here/BASE/</code></pre>
<section id="r-definitions" class="level4">
<h4 class="anchored" data-anchor-id="r-definitions">R, Definitions</h4>
<ul>
<li><p><strong>object</strong> Most computer languages do NOT allow direct access to memory. In R, various data structures (called <code>Objects</code> provide access. Use symbols or variables to access the the <code>Objects</code>. Unique to R(?), symbols are also objects and can be manipulated (example?).</p></li>
<li><p><strong>intrepreted vs compiler code</strong> The former is source code that is executed line-by-line. The later is machine code. Between the two, is wide spectrum</p></li>
<li><p><strong>struct</strong> (C, non-R) a collection that can hold multiple types, eg <code>db     record</code>.</p></li>
</ul>
<pre><code>    struct record
    {
        char name[32];
        int age;
        float debt;
    }
#   To use:
    struct record X    # X is variable, struct is keyword, `record` is struct</code></pre>
<ul>
<li><strong>monad</strong> - As goal, seek functions with (1) no side effects (2) can be composed. Function factories can be useful, esp where variables can be ‘stored’ in environment. SEE BRUNO video.</li>
</ul>
</section>
</section>
<section id="shiny-shinylive-webr-webassembly" class="level3">
<h3 class="anchored" data-anchor-id="shiny-shinylive-webr-webassembly">Shiny, ShinyLive, webR, webassembly</h3>
<pre><code>**webassembly** Code, assembler-like?, byte-code-like? with very compact binary format and has API **javascript** can natively(?) use; runs fast.  C, Rust et al can be compiled (with tools) to webassembly.  Why **JS** ?  JS easily talks to HTML widget, components ...
**webR::** package downloads installs R binaries for use in webassembly.
**ShinyLive** 4 pieces, shinylive assets (includes version of webR to Run R in browser, plus View()), R Shiny package; python version; quarto extension 

Regular Shiny app can run in browser (no external server).  All the pieces R, Shiny app, Shiny server converted to webassembly or otherise hosted in browser and/or cache.
Read:   https://blog.djnavarro.net/posts/2023-04-09_webr/, 
It is not magic:  much parsing, grammar and generating JS modules:  
-  https://github.com/TravisYeah/lezer-r
-  https://lezer.codemirror.net/
-  For parsing R, see R Language Manuals, Ch 10 parsing.</code></pre>
</section>
<section id="shiny-and-dt" class="level3">
<h3 class="anchored" data-anchor-id="shiny-and-dt">Shiny and DT</h3>
<ul>
<li>embed html, see !so 69471577</li>
</ul>
<pre><code>## Bugzilla &lt; https://bugs.r-project.org/ &gt;
-   Besides R bugs good place to see intersection of documentation, R and bugs.

-   &lt;https://vroom.r-lib.org&gt; package uses new internal data structure *ALTREP* &lt;https://www.r-project.org/dsc/2017/slides/dsc2017.pdf&gt;

        
***

::: {.callout-note}
All R, math, statistics  notes here. 
:::

[call](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/call.html)
[expression](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/expression.html)
[language](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/is.language.html)

[mode]](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/mode.html)
[typeof](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/typeof.html)
[vector](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/vector.html)
[substitute](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/base/html/substitute.html)


## {{&lt; include _future_work.qmd &gt;}}
## Environemnts, Namespacds
-   conflicted package.

#{{&lt; include _references.qmd &gt;}}</code></pre>
</section>
<section id="parquet-database-r4ds-chapter-22" class="level3">
<h3 class="anchored" data-anchor-id="parquet-database-r4ds-chapter-22">parquet, database (r4ds Chapter 22)</h3>
<ul>
<li>parquet file is now popular, esp large datasets (csv too slow)</li>
<li>Arrow package set of tools; to convert csv to parquet; to translate queries from dplyr and run them againt parquet</li>
</ul>
</section>
<section id="following-references-was-removed-and-now-added-back-112024" class="level3">
<h3 class="anchored" data-anchor-id="following-references-was-removed-and-now-added-back-112024">Following <code>References</code> was removed and now added back (11/2024)…</h3>
</section>
<section id="metaprogramming-nse" class="level3">
<h3 class="anchored" data-anchor-id="metaprogramming-nse">Metaprogramming, NSE</h3>
<ul>
<li>Hadley, Advanced R, version 1 (Expressions)</li>
<li>Quoting/Eval: Lionel: https://rpubs.com/lionel-/programming-draft<br>
</li>
<li>https://rpubs.com/lionel-/tidyeval-introduction</li>
<li>https://rpubs.com/lionel-/tidyeval-dplyr-recipes</li>
<li>{{}} * https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/</li>
<li>https://rpubs.com/lionel-/superstache Brodie Gaslam - https://www.brodieg.com/2020/05/05/on-nse/ , Mailund - Metaprogramming R Journal, Murdock R Language Definition</li>
</ul>
</section>
<section id="articles" class="level3">
<h3 class="anchored" data-anchor-id="articles">Articles</h3>
<ul>
<li><p>Quoting/Eval: Lionel: https://rpubs.com/lionel-/programming-draft<br>
</p></li>
<li><p>https://rpubs.com/lionel-/tidyeval-introduction</p></li>
<li><p>https://rpubs.com/lionel-/tidyeval-dplyr-recipes</p></li>
<li><p>{{}} * https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/</p></li>
<li><p>https://rpubs.com/lionel-/superstache Brodie Gaslam - https://www.brodieg.com/2020/05/05/on-nse/</p></li>
<li><p>https://www.rostrum.blog/2023/03/03/getparsedata/ (parse, tokens, more advanced)</p></li>
<li><p>https://renkun.me/2020/11/08/using-parse-data-to-analyze-r-code/ (parse(), XPATH, rlanguage server)</p></li>
<li><p>function masking/pkgs: https://www.r-bloggers.com/2013/09/control-the-function-scope-by-the-r-package-namescope/ (using namespace to control scop)</p></li>
<li><p>{}} - https://www.r-bloggers.com/2019/06/curly-curly-the-successor-of-bang-bang-2/</p></li>
<li><p>env stack - https://www.r-bloggers.com/2014/12/tips-on-non-standard-evaluation-in-r/</p></li>
<li><p>quoting, dplyr - https://www.r-bloggers.com/2019/07/bang-bang-how-to-program-with-dplyr/</p></li>
<li><p>2012 namespace pkg, by Hadley, et al : https://cran.r-project.org/web/packages/namespace/index.html</p></li>
<li><p><strong>Examples</strong></p></li>
<li><p>http://zevross.com/blog/2018/09/11/writing-efficient-and-streamlined-r-code-with-help-from-the-new-rlang-package/ (mostly ggplot2)</p></li>
<li><p>Murdoch, R Journal vol 2/2 2010</p></li>
<li><p>statisticsglob.com (several parse examples)</p></li>
<li><p><a href="https://statisticsglobe.com/parse-deparse-expression-r-function" class="uri">https://statisticsglobe.com/parse-deparse-expression-r-function</a></p></li>
<li><p>&lt;advanced-r-solutions.rbind.io/expressions.html&gt;</p></li>
<li><p>Tierney, codeTools ?</p></li>
</ul>
</section>
<section id="manuals" class="level3">
<h3 class="anchored" data-anchor-id="manuals">Manuals:</h3>
<ul>
<li><p>R-exts:package-ns: https://cran.r-project.org/doc/manuals/R-exts.html#Package-namespaces</p></li>
<li><p>R-ints - 1.2 https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Environments-and-variable-lookup - 1.4 C structs, Contexts (https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Contexts) - 1.5 When is argument evaluated? R-Lang <a href="https://cran.r-project.org/doc/manuals/R-lang.html" class="uri">https://cran.r-project.org/doc/manuals/R-lang.html</a><br>
- 2.1.3 Language Objects (calls, expressions, names) - 3 Evaluation - 6 Compute on Language: https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Computing-on-the-language</p></li>
<li><p>ns-load: https://stat.ethz.ch/R-manual/R-devel/library/base/html/ns-load.html</p></li>
<li><p>getFromNamespace: https://stat.ethz.ch/R-manual/R-devel/library/utils/html/getFromNamespace.html</p></li>
<li><p><strong>stackoverflow</strong></p></li>
<li><p>https://stackoverflow.com/questions/46834655/whats-the-difference-between-substitute-and-quote-in-r</p></li>
<li><p>https://stackoverflow.com/questions/14988722/in-r-what-does-loaded-via-a-namespace-and-not-attached-mean</p></li>
<li><p>{{}}https://stackoverflow.com/questions/62791997/what-is-the-embracing-operator</p></li>
<li></li>
<li><p><strong>Posit</strong></p></li>
<li><p>ns, but not in package: https://community.rstudio.com/t/is-it-dangerous-to-create-a-namespace-for-functions-in-a-script-without-a-package/91141</p></li>
</ul>
</section>
<section id="packages-using-metaprogramming-environments" class="level3">
<h3 class="anchored" data-anchor-id="packages-using-metaprogramming-environments">Packages using metaprogramming; environments</h3>
<pre><code>-   wrapr https://winvector.github.io/wrapr/index.html useful?
-   lintr  (parses)
-   rlangserver
-   envnames:: code for working with env, older https://github.com/mastropi/envnames
-   </code></pre>
<p>https://statisticsglobe.com/parse-deparse-expression-r-function ### LISP &amp; R</p>
<p>Holiday Reading !??</p>
<p>Many years ago, one of my freshman college roommates walked in the door speaking high praises for LISP.<br>
For some of us, it takes a longer to catch on. Over the weekend, I read through the “EVAL” chapter (Chapter 3) of Common LISP ( https://www.cs.cmu.edu/~dst/LispBook/) (Tourteszky, Introduction to Common LISP - 1990).</p>
<p>“So that’s what R is trying to do!”</p>
<p>Seems that LISP is cleaner way to introduce the many list-like structures of R and how they built, passed, evaluated or otherwise manipulated.</p>
<p>Then I read a chapter of this book and it too greatly helped with R. More light bulbs went on.</p>
<p>Metaprogramming in R (https://www.amazon.com/exec/obidos/ASIN/1484228804/acmorg-20) by Thomas Mailund (also:</p>
<p>More from Thomas Mailund: https://mailund.github.io/r-programmer-blog/2018/09/20/scoping-rules-and-nse/)</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>